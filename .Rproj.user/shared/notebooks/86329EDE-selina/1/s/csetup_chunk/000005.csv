"0","library(tidyverse)"
"0","library(scales)"
"0","library(""GGally"")"
"0",""
"0","options(scipen=999)"
"0",""
"0","invalids <- c("
"0","""Antigua"""
"0",",""Puerto Escondido"""
"0",",""Pedasi"""
"0",",""Banos"""
"0",",""Cusco"""
"0",")"
"0",""
"0","dat <- read_csv('/home/andr31/R/practice/selina/selina.csv') %>% "
"0","  rowwise() %>% "
"0","  mutate(`Total Revenue`=sum(`Room Revenue USD`,`Food and Beverage Revenue`,`Activities Revenue`,`Co-Working Revenue`),"
"0","         Occupancy=`Sold Beds`/`Available Beds`) %>% "
"0","  mutate(TREVOB=`Total Revenue`/`Available Beds`) %>% "
"0","  mutate(Opening=if_else(Selina %in% invalids,""Unreliable Data"",if_else("
"0","    Selina %in% c(""Playa del Carmen"",""Montanita"",""Mexico City"",""Cartagena""),""Q1 2018"",if_else("
"0","      Selina %in% c(""Quito"",""Lima"",""Bogota La Candelaria""),""Q3 2018"",""Q4 2017"""
"0","    ))"
"0","  )) %>% "
"0","  mutate(Period=format(as.Date(Date, format = ""%m/%d/%Y""),""%Y/%m""))"
"0",""
"0","dat_loc <- dat %>% "
"0","  group_by(Opening,Selina) %>% "
"0","  summarise(Total_Revenue=sum(`Total Revenue`),"
"0","            Available_Beds=sum(`Available Beds`),"
"0","            Sold_Beds=sum(`Sold Beds`),"
"0","            Rating=mean(`Average Guest Review`),"
"0","            count=n()"
"0","              ) %>% "
"0","  mutate(Occupancy=Sold_Beds/Available_Beds,"
"0","         TREVOB=Total_Revenue/Sold_Beds)"
"0",""
"0","  #mutate("
"0","  #  Type=if_else("
"0","  #    TREVOB>as.numeric(quantile(TREVOB,.75))+1.5*IQR(TREVOB)|"
"0","  #    TREVOB<as.numeric(quantile(TREVOB,.75))-1.5*IQR(TREVOB)|"
"0","  #    Occupancy>as.numeric(quantile(Occupancy,.75))+1.5*IQR(Occupancy)|"
"0","  #    Occupancy<as.numeric(quantile(Occupancy,.75))-1.5*IQR(Occupancy)"
"0","  #    ,""Outlier"",""Non-Outlier"")"
"0","  #)"
"0",""
"0","dat_comp <- dat %>% "
"0","  filter(Opening==""Q4 2017"")"
"0",""
"0","avg_occ <- sum(dat_comp$`Sold Beds`)/sum(dat_comp$`Available Beds`)"
"0","avg_trv <- sum(dat_comp$`Total Revenue`)/sum(dat_comp$`Sold Beds`)"
"0",""
"0","    ggplot(dat_loc) +"
"0","      geom_point(aes(x=Occupancy,y=TREVOB,size=Rating,colour=Opening)) +"
"0","      geom_text(aes(x=Occupancy,y=TREVOB,label=Selina),hjust=.5, vjust=0,angle=30,size=3) +"
"0","      geom_vline(xintercept=avg_occ,linetype=""dotted"") +"
"0","      geom_hline(yintercept=avg_trv,linetype=""dotted"") +"
"0","      #scale_color_manual(values=c(""gray"", ""red"")) +"
"0","      ggtitle(""Occupancy vs. Revenue (Q42017 - Y2018)"",""by Location"") +"
"0","      labs(y=""TREVOB ($USD)"") +"
"0","      theme_minimal()"
